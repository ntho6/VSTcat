<!DOCTYPE html>
<html>

<head>
    <title>VSTcat</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="./assets/media/cat.png">
    <link rel="stylesheet" type="text/css" href="./assets/files/style.css">
</head>

<body>
    <div class="container">
        <img src="./assets/media/logo.svg">
        <p>Enter the name of the VST you want to search for:</p>
        <input type="text" placeholder="Omnisphere..." autocomplete="off" id="search-input">
        <button onclick="search()">Search</button>
        <div id="results"></div>
    </div>
    <script type="text/javascript">
        function loadJSON(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.overrideMimeType("application/json");
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if (xhr.status == "200") {
                        callback(xhr.responseText);
                    } else {
                        callback(null);
                    }
                }
            };
            xhr.send(null);
        }

        function search() {
            var input = document.getElementById("search-input").value.trim(); // Rimuoviamo spazi vuoti all'inizio e alla fine
            var results = document.getElementById("results");
            results.innerHTML = "";

            if (input === "") {
                results.innerHTML = "Please enter a search term.";
                return;
            }

            loadJSON('./assets/files/vst_data.json', function (response) {
                var vsts = JSON.parse(response);
                var matches = vsts.filter(function (vst) {
                    return vst.name.toLowerCase().includes(input.toLowerCase());
                });

                if (matches.length > 0) {
                    displayResults(matches);
                } else {
                    loadJSON('./assets/files/vst_data_2.json', function (response2) {
                        if (response2) {
                            var vsts2 = JSON.parse(response2);
                            var matches2 = vsts2.filter(function (vst) {
                                return vst.name.toLowerCase().includes(input.toLowerCase());
                            });

                            if (matches2.length > 0) {
                                displayResults(matches2);
                            } else {
                                results.innerHTML = "No results found.";
                            }
                        } else {
                            results.innerHTML = "No results found.";
                        }
                    });
                }
            });
        }

        function displayResults(matches) {
            var results = document.getElementById("results");
            results.innerHTML = "";

            matches.forEach(function (vst) {
                var resultBox = document.createElement("div");
                resultBox.className = "result-box";

                var link = document.createElement("a");
                link.href = vst.link;
                link.innerHTML = vst.name;

                resultBox.appendChild(link);

                results.appendChild(resultBox);
            });
        }

        document.addEventListener("keydown", function () {
            var x = event.keyCode || event.which;
            if (x == 13) {
                search();
            }
        });
    </script>
    <footer>
        <hr>
        <a href="https://github.com/ntho6/VSTcat#reminder"> Disclaimer</a>
    </footer>
</body>

</html>